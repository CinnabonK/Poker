<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>テキサス・ホールデム</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #2c3e50;
            color: white;
            text-align: center;
        }

        #player-form {
            margin-bottom: 20px;
        }

        .player-area {
            position: relative;
            width: 600px;
            height: 600px;
            margin: 0 auto;
            border-radius: 50%;
            border: 2px solid white;
        }

        .player {
            position: absolute;
            width: 100px;
            height: 100px;
            background-color: #34495e;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
        }

        .player.current {
            background-color: #e74c3c;
        }

        .player-name {
            font-size: 14px;
        }

        .chips {
            font-size: 12px;
        }

        #dealer-cards {
            margin: 20px 0;
            font-size: 24px;
        }

        #pot {
            margin-top: 20px;
            font-size: 24px;
            background-color: #e74c3c;
            padding: 10px;
            border-radius: 10px;
            display: inline-block;
        }

        .action-buttons {
            margin-top: 20px;
        }

        button {
            padding: 10px 20px;
            margin: 10px;
            background-color: #2980b9;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }

        button:hover {
            background-color: #3498db;
        }

        input[type="range"] {
            width: 300px;
        }

        #next-player {
            font-size: 20px;
            margin-top: 30px;
        }

        .winner-screen {
            display: none;
        }

        .winner-screen h2 {
            font-size: 36px;
            color: #2ecc71;
        }

        .winner-screen button {
            background-color: #27ae60;
        }

        #card-check-scene, #poker-table-scene {
            display: none;
        }

        .player-list {
            margin-bottom: 20px;
        }

        .player-list ul {
            list-style-type: none;
            padding: 0;
        }

        .player-list li {
            font-size: 18px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

    <h1>テキサス・ホールデム</h1>

    <!-- プレイヤー追加フォーム -->
    <div id="player-form">
        <label for="player-name">プレイヤー名を入力してください：</label>
        <input type="text" id="player-name">
        <button onclick="addPlayer()">追加</button>
        <button onclick="startGame()">ゲーム開始</button>
        <button onclick="removePlayer()">削除</button>
    </div>

    <!-- プレイヤーリスト -->
    <div class="player-list">
        <ul id="player-names">
            <!-- プレイヤー名を表示 -->
        </ul>
    </div>

    <!-- ポーカーテーブルシーン -->
    <div id="poker-table-scene">
        <!-- プレイヤー表示エリア -->
        <div class="player-area" id="players"></div>

        <!-- ディーラーがめくったカード -->
        <div id="dealer-cards">ディーラーのカード: </div>

        <!-- ポット -->
        <div id="pot">ポット: 0コイン</div>

        <!-- BETスライダー -->
        <div>
            <input type="range" id="bet-amount-slider" min="1" max="1000" value="1" oninput="updateBetAmount()">
            <span id="bet-amount-display">1</span>コイン
        </div>

        <!-- 行動ボタン -->
        <div class="action-buttons">
            <button onclick="bet()">BET</button>
            <button onclick="call()">CALL</button>
            <button onclick="fold()">FOLD</button>
            <button onclick="check()" id="check-button">CHECK</button>
        </div>

        <!-- 次のプレイヤー -->
        <div id="next-player"></div>
    </div>

    <!-- 勝利画面 -->
    <div id="winner-screen" class="winner-screen">
        <h2>勝者: <span id="winner-name"></span></h2>
        <p id="winner-chips"></p>
        <p id="winner-hand"></p>
        <div id="all-hands"></div>
        <button onclick="restartGame()">再対局</button>
    </div>

    <script>
        const players = [];
        let currentPlayerIndex = 0;
        let pot = 0;
        let tableCards = [];
        let previousBet = 0;
        let activePlayers = [];
        let allChecked = false;

        function addPlayer() {
            if (players.length >= 10) {
                alert("プレイヤーは10人までです。");
                return;
            }

            const name = document.getElementById("player-name").value;
            if (name) {
                players.push({ name: name, chips: 1000, cards: [], isFolded: false, hasChecked: false });
                document.getElementById("player-name").value = '';
                updatePlayersUI();
                updatePlayerList();
            }
        }

        function removePlayer() {
            const name = document.getElementById("player-name").value;
            const index = players.findIndex(player => player.name === name);
            if (index > -1) {
                players.splice(index, 1);
                document.getElementById("player-name").value = '';
                updatePlayersUI();
                updatePlayerList();
            }
        }

        function updatePlayerList() {
            const playerList = document.getElementById("player-names");
            playerList.innerHTML = '';
            players.forEach(player => {
                const li = document.createElement("li");
                li.textContent = player.name;
                playerList.appendChild(li);
            });
        }

        function updatePlayersUI() {
            const playerArea = document.getElementById('players');
            playerArea.innerHTML = '';
            const n = players.length;
            const centerX = 300;
            const centerY = 300;
            const radius = 250;
            
            players.forEach((player, index) => {
                const angle = (index * (360 / n)) * (Math.PI / 180);
                const x = centerX + radius * Math.cos(angle);
                const y = centerY + radius * Math.sin(angle);
                
                const playerDiv = document.createElement('div');
                playerDiv.classList.add('player');
                if (index === currentPlayerIndex) {
                    playerDiv.classList.add('current');
                }
                playerDiv.style.left = `${x - 50}px`; 
                playerDiv.style.top = `${y - 50}px`;  
                playerDiv.innerHTML = `
                    <div class="player-name">${player.name}</div>
                    <div class="chips" id="chips-${player.name}">${player.chips}コイン</div>
                `;
                playerArea.appendChild(playerDiv);
            });
        }

        function startGame() {
            if (players.length < 2) {
                alert("プレイヤーは2人以上必要です。");
                return;
            }
            activePlayers = players.filter(player => player.chips > 0);
            document.getElementById('player-form').style.display = 'none';
            document.getElementById('poker-table-scene').style.display = 'block';
            dealInitialCards();
            startPlayerTurn();
        }

        function dealInitialCards() {
            // ディーラーが最初に3枚カードをめくる
            tableCards = ['♠️A', '♦️K', '♣️Q']; // カード例（本来はランダムに生成）
            document.getElementById('dealer-cards').innerText = `ディーラーのカード: ${tableCards.join(', ')}`;
        }

        function startPlayerTurn() {
            const player = activePlayers[currentPlayerIndex];
            if (player.isFolded || player.chips === 0) {
                nextPlayer();
                return;
            }
            document.getElementById('next-player').innerText = `${player.name}のターンです。`;
            document.getElementById("bet-amount-slider").max = player.chips; // スライダーの最大値をプレイヤーの所持金に設定
            updateBetAmount();
        }

        function updateBetAmount() {
            const sliderValue = document.getElementById("bet-amount-slider").value;
            document.getElementById("bet-amount-display").innerText = sliderValue;
        }

        function bet() {
            const player = activePlayers[currentPlayerIndex];
            const betAmount = parseInt(document.getElementById('bet-amount-slider').value, 10);

            if (betAmount >= player.chips) {
                alert("オールインします！");
                pot += player.chips;
                previousBet = player.chips;
                player.chips = 0;
            } else {
                pot += betAmount;
                previousBet = betAmount;
                player.chips -= betAmount;
            }

            updatePlayerChips(player);
            updatePot();
            nextPlayer();
        }

        function call() {
            const player = activePlayers[currentPlayerIndex];

            if (previousBet > player.chips) {
                pot += player.chips;
                player.chips = 0;
            } else {
                pot += previousBet;
                player.chips -= previousBet;
            }

            updatePlayerChips(player);
            updatePot();
            nextPlayer();
        }

        function fold() {
            activePlayers[currentPlayerIndex].isFolded = true;
            nextPlayer();
        }

        function check() {
            const player = activePlayers[currentPlayerIndex];
            player.hasChecked = true;

            // 全員がチェックしたか確認
            if (activePlayers.every(p => p.isFolded || p.hasChecked)) {
                revealHandsAndDecideWinner();
            } else {
                nextPlayer();
            }
        }

        function nextPlayer() {
            do {
                currentPlayerIndex = (currentPlayerIndex + 1) % activePlayers.length;
            } while (activePlayers[currentPlayerIndex].isFolded || activePlayers[currentPlayerIndex].chips === 0);

            // 次のターンを開始
            startPlayerTurn();
        }

        function updatePlayerChips(player) {
            document.getElementById(`chips-${player.name}`).innerText = `${player.chips}コイン`;
        }

        function updatePot() {
            document.getElementById('pot').innerText = `ポット: ${pot}コイン`;
        }

        function revealHandsAndDecideWinner() {
            const handsContainer = document.getElementById('all-hands');
            handsContainer.innerHTML = '';
            let winner = null;
            let highestRank = -1;

            activePlayers.forEach(player => {
                if (!player.isFolded) {
                    const hand = player.cards.concat(tableCards);
                    const rankedHand = rankHands(hand);
                    handsContainer.innerHTML += `<p>${player.name}の手札: ${hand.join(', ')} (${rankedHand.name})</p>`;
                    if (rankedHand.rank > highestRank) {
                        highestRank = rankedHand.rank;
                        winner = player;
                    }
                }
            });

            declareWinner(winner);
        }

        function declareWinner(winner) {
            const hand = winner.cards.concat(tableCards);
            const rankedHand = rankHands(hand);
            document.getElementById('winner-name').innerText = winner.name;
            document.getElementById('winner-chips').innerText = `獲得チップ: ${pot}`;
            document.getElementById('winner-hand').innerText = `役: ${rankedHand.name}`;
            document.getElementById('winner-screen').style.display = 'block';
        }

        function rankHands(cards) {
            const hand = cards.map(card => {
                const value = card.slice(1);
                return { suit: card[0], value: isNaN(value) ? convertFaceCard(value) : parseInt(value, 10) };
            });

            hand.sort((a, b) => b.value - a.value);

            if (isRoyalFlush(hand)) return { name: 'ロイヤルフラッシュ', rank: 9 };
            if (isStraightFlush(hand)) return { name: 'ストレートフラッシュ', rank: 8 };
            if (isFourOfAKind(hand)) return { name: 'フォーカード', rank: 7 };
            if (isFullHouse(hand)) return { name: 'フルハウス', rank: 6 };
            if (isFlush(hand)) return { name: 'フラッシュ', rank: 5 };
            if (isStraight(hand)) return { name: 'ストレート', rank: 4 };
            if (isThreeOfAKind(hand)) return { name: 'スリーカード', rank: 3 };
            if (isTwoPair(hand)) return { name: 'ツーペア', rank: 2 };
            if (isOnePair(hand)) return { name: 'ワンペア', rank: 1 };

            return { name: 'ハイカード', rank: 0 };
        }

        function convertFaceCard(faceCard) {
            switch (faceCard) {
                case 'A': return 14;
                case 'K': return 13;
                case 'Q': return 12;
                case 'J': return 11;
                default: return 0;
            }
        }

        function isFlush(hand) {
            return hand.every(card => card.suit === hand[0].suit);
        }

        function isStraight(hand) {
            for (let i = 1; i < hand.length; i++) {
                if (hand[i - 1].value - hand[i].value !== 1) {
                    return false;
                }
            }
            return true;
        }

        function isRoyalFlush(hand) {
            return isStraightFlush(hand) && hand[0].value === 14 && hand[4].value === 10;
        }

        function isStraightFlush(hand) {
            return isFlush(hand) && isStraight(hand);
        }
    </script>

</body>
</html>
